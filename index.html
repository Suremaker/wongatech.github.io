<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on https://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" href="stylesheets/pygment_trac.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>LightBDD at Wonga</title>
  <meta name="description" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">LightBDD at Wonga</h1>
    </header>
    <div id="container">
      <p class="tagline"></p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/wongatech" class="code">View LightBDD at Wonga on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <p>After using <a href="http://fitnesse.org/">FitNesse</a> and <a href="http://www.specflow.org">SpecFlow</a>, I created <a href="https://github.com/Suremaker/LightBDD">LightBDD</a> as a developer-friendly way to write acceptance tests. LightBDD allows you to write acceptance tests entirely in code, using all the features of your IDE to create, maintain and refactor them, and generates reports that the whole team can use to ensure you're building the right thing.</p>

<h2>
<a id="a-bit-of-history-fitnesse" class="anchor" href="#a-bit-of-history-fitnesse" aria-hidden="true"><span class="octicon octicon-link"></span></a>A bit of history: FitNesse</h2>

<p>A few years ago, I was working on a project to create a web application for airport employees. We started experimenting with a new approach to writing and validating requirements.</p>

<p>The idea was that business analysts (BAs) would write requirements and we would automatically validate the system against them. The BAs were not programmers so we looked for tools which made it easy to write tests. We chose FitNesse, which provides a friendly test editor and  allows tests to be run from the UI. BAs could write new tests and run them immediately.</p>

<p>As our experience grew, we realised this approach had some pitfalls. What can be expressed in a test is limited to the set of conventions, keywords and methods supported by the underlying mapping code. Furthermore, the editor is just a plain text editor. It doesn't suggest method names or constructs that can be used in tests. If you don't know the underlying code, the only way to see what test syntax is available was to copy from other tests.</p>

<p>I don't recall a single instance of a BA using the FitNesse editor to write a test. Maybe they were too busy or maybe the tools created a barrier to entry. Developers wrote all tests and the mappings themselves. Writing tests this way was not fun. Any changes to the code meant all the corresponding tests had to be changed as well, in a basic plain text editor. Large changes to the tests or code were quite painful.</p>

<h2>
<a id="a-bit-more-history-specflow" class="anchor" href="#a-bit-more-history-specflow" aria-hidden="true"><span class="octicon octicon-link"></span></a>A bit more history: SpecFlow</h2>

<p>A few years later, on a different project, company and country, we tried <a href="http://dannorth.net/introducing-bdd/">behaviour-driven development</a> (BDD) using SpecFlow to map acceptance criteria to code.</p>

<p>In BDD, acceptance criteria are structured as scenarios, e.g.:</p>

<div class="highlight highlight-gherkin"><pre>Story: Returns go to stock

In order to keep track of stock
As a store owner
<span class="pl-k">I </span>want to add items back to stock when they're returned

Scenario 1: Refunded items should be returned to stock
<span class="pl-k">Given </span>a customer previously bought a black sweater from me
<span class="pl-k">And </span>I currently have three black sweaters left in stock
<span class="pl-k">When </span>he returns the sweater for a refund
<span class="pl-k">Then </span>I should have four black sweaters in stock</pre></div>

<p>(Example from <a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Wikipedia</a>.)</p>

<p>As our codebase and acceptance test suite grew, we realised that it was difficult to keep the acceptance criteria in plain text and the mapping code in sync. Also it made maintaining the test code hard, we couldn't see which test methods were in use and which could be removed for example.</p>

<p>Out of frustration with SpecFlow, I started working on a test framework that would allow us to:</p>

<ul>
<li>Keep all of our test definitions as clear as possible, so they would be readable and editable by people who aren't programmers</li>
<li>Use all of the standard refactoring methods and IDE help to maintain those tests</li>
</ul>

<h2>
<a id="lightbdd" class="anchor" href="#lightbdd" aria-hidden="true"><span class="octicon octicon-link"></span></a>LightBDD</h2>

<p>LightBDD is an open-source, lightweight framework for behaviour-driven development.</p>

<p>It's designed to strike a balance between writing test criteria so they can be understood by anyone and test code which is easy to maintain and extend.</p>

<p>In any BDD framework, acceptance tests have to be mapped to code at some point. In LightBDD we write the acceptance criteria directly in code so developers can use their IDE to maintain tests in an easy and natural way. There's no translation step, so there's only one version of the code and tests to maintain.</p>

<p>LightBDD is easy to learn and adopt and speeds up the overall development cycle.</p>

<h3>
<a id="easy-to-read-scenarios" class="anchor" href="#easy-to-read-scenarios" aria-hidden="true"><span class="octicon octicon-link"></span></a>Easy to read scenarios</h3>

<p>Here's how the example scenario above would look in LightBDD:</p>

<div class="highlight highlight-csharp"><pre>[FeatureDescription(
@<span class="pl-s"><span class="pl-pds">"</span>In order to keep track of stock</span>
<span class="pl-s">As a store owner</span>
<span class="pl-s">I want to add items back to stock when they're returned<span class="pl-pds">"</span></span>)]
[TestFixture]
<span class="pl-k">public</span> <span class="pl-k">partial</span> <span class="pl-k">class</span> <span class="pl-en">Returns_go_to_stock</span>
{
    [Test]
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">Refunded_items_should_be_returned_to_stock</span>()
    {
        Runner.RunScenario(
            Given_a_customer_previously_bought_a_black_sweater_from_me,
            And_I_currently_have_three_black_sweaters_left_in_stock,
            When_he_returns_the_sweater_for_a_refund,
            Then_I_should_have_four_black_sweaters_in_stock);
    }
}</pre></div>

<h3>
<a id="integration-with-existing-tools" class="anchor" href="#integration-with-existing-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Integration with existing tools</h3>

<p>LightBDD is really just some conventions for structuring NUnit tests. You can use all the tools that Visual Studio and Resharper provide for refactoring, code analysis, e.g. finding unused methods, and executing tests.</p>

<p>Here's the implementation of the above scenario:</p>

<div class="highlight highlight-csharp"><pre><span class="pl-k">public</span> <span class="pl-k">partial</span> <span class="pl-k">class</span> <span class="pl-en">Returns_go_to_stock</span> : <span class="pl-k">FeatureFixture</span>
{
    <span class="pl-k">private</span> Item _sweater;
    <span class="pl-k">private</span> Shop _shop;

    [SetUp]
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">SetUp</span>()
    {
        _shop = <span class="pl-k">new</span> Shop();
    }

    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">Given_a_customer_previously_bought_a_black_sweater_from_me</span>()
    {
        _sweater = <span class="pl-k">new</span> Item(ItemType.Sweater, Color.Black);
    }

    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">And_I_currently_have_three_black_sweaters_left_in_stock</span>()
    {
        _shop.Stock.Add(<span class="pl-k">new</span> Item(ItemType.Sweater, Color.Black));
        _shop.Stock.Add(<span class="pl-k">new</span> Item(ItemType.Sweater, Color.Black));
        _shop.Stock.Add(<span class="pl-k">new</span> Item(ItemType.Sweater, Color.Black));
    }

    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">When_he_returns_the_sweater_for_a_refund</span>()
    {
        _shop.Refund(_sweater);
    }

    <span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">Then_I_should_have_four_black_sweaters_in_stock</span>()
    {
        Assert.That(
            _shop.Stock.Count(i =&gt; i.Type == ItemType.Sweater &amp;&amp; i.Color == Color.Black),
            Is.EqualTo(<span class="pl-c1">4</span>));
    }
}</pre></div>

<h3>
<a id="reports-in-html-plain-text-and-xml" class="anchor" href="#reports-in-html-plain-text-and-xml" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reports in HTML, plain text and XML</h3>

<p>!!! REPORT SCREENSHOT !!!</p>

<p>LightBDD generates <a href="http://htmlpreview.github.io/?https://github.com/Suremaker/LightBDD/blob/master/ExampleSummaryFiles/FeaturesSummary.html">test reports in HTML</a>. Anyone can read them and they contain a lot of useful detail. It can also generate plain text or XML for further processing.</p>

<h2>
<a id="lightbdd-at-wonga" class="anchor" href="#lightbdd-at-wonga" aria-hidden="true"><span class="octicon octicon-link"></span></a>LightBDD at Wonga</h2>

<p>At Wonga, LightBDD is a key tool for documenting the quality of our software. This is a requirement for our FCA authorisation process and LightBDD's reports serve as evidence that our code is correct    .</p>

<p>Product owners define scenarios in JIRA. Developers use those scenarios to write LightBDD tests. We use the <a href="https://github.com/Suremaker/LightBDD/wiki/02-Tests-Structure-and-Conventions"><code>Label</code></a> and <a href="https://github.com/Suremaker/LightBDD/wiki/02-Tests-Structure-and-Conventions"><code>Category</code></a> attributes to associate tests with JIRA stories and epics.</p>

<p>We run our acceptance tests in CI and archive the LightBDD reports. The HTML report is presented to POs as proof that a requested feature has been implemented properly. It's also used to map scenarios back to requirements and functions as evidence that we've built the right thing for our customers. XML reports are used to collect statistics on quality across projects.</p>

<h2>
<a id="read-more" class="anchor" href="#read-more" aria-hidden="true"><span class="octicon octicon-link"></span></a>Read more</h2>

<p>If LightBDD sounds interesting, visit the <a href="https://github.com/Suremaker/LightBDD">project page</a> on GitHub.</p>

<p>It's also worth checking out the <a href="https://github.com/Suremaker/LightBDD/wiki">wiki</a>, which contains a lot more detail about LightBDD's features.</p>

<p>-- Wojciech Kotlarski</p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">

      <p><a href="https://github.com/wongatech" class="avatar"><img src="https://avatars0.githubusercontent.com/u/7767615?v=3&amp;s=60" width="48" height="48"></a>View <a href="https://github.com/wongatech">wongatech</a> on <a href="https://www.github.com">GitHub</a></p>

      </div>
      <div class="creds">
        <small>This page generated using <a href="https://pages.github.com/">GitHub Pages</a><br>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/wongatech/wongatech.github.io/tarball/master" class="tar">tar</a><a href="https://github.com/wongatech/wongatech.github.io/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

  
</body>
</html>
